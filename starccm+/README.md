# Overview

This workflow runs a Simcenter STAR-CCM+ simulation in batch (non-GUI) mode on an HPC cluster using SLURM, MPI parallelism, and a POD (Power-on-Demand) license key.

The provided SLURM script has been verified to work with:

- STAR-CCM+ version: 18.02.008
- License mode: POD (-power -podkey) with FlexNet license server
- Parallel scale: 4 MPI ranks (known-working configuration)

---

## Files Required

- `submit_starccm.sh`  
  SLURM batch script

- `simple_airfoil_flow.sim`  
  Existing STAR-CCM+ simulation file

- `run_sim.java`  
  Java macro executed in batch mode

- `machinefile.<jobid>`  
  Auto-generated MPI host file (created at runtime)

---

## SLURM Script Summary

```bash
#!/bin/bash
#SBATCH -t 0-01:00:00
#SBATCH -N 1
#SBATCH --ntasks-per-node=4
#SBATCH --partition=normal_q
#SBATCH --account=personal
```

## Resource Allocation

- Nodes: 1
- MPI ranks: 4 (this is important â€” Check out the license tokens limits)
- Walltime: 1 hour
- Partition/Account: cluster-specific (normal_q, personal)

## Environment Setup

```bash
module reset
module load STAR-CCM+/18.02.008
```
- Loads a known-compatible STAR-CCM+ version.
- Avoids conflicts from previously loaded modules.

## Machine File Generation (Required for MPI)
```bash
MACHINEFILE=./machilefile.$SLURM_JOBID
scontrol show hostname $SLURM_NODELIST > $MACHINEFILE
```

- STAR-CCM+ requires a machinefile for MPI runs.
- SLURM dynamically generates the list of allocated hosts.
- The file is unique per job ($SLURM_JOBID).

## STAR-CCM+ Execution Command
```bash
starccm+ -power \
  -podkey <your license key> \
  -licpath <FlexNet license server> \
  -batch run_sim.java \
  -np $SLURM_NTASKS -machinefile $MACHINEFILE \
  $SIMFILEPATH
```
- power	Enables POD (Power-on-Demand) licensing
- podkey: User-specific POD license key
- licpath: FlexNet license server (required)
- batch run_sim.java: Runs STAR-CCM+ headlessly using a Java macro
- np $SLURM_NTASKS: Number of MPI ranks
-machinefile: MPI host list generated by SLURM

## Why This Configuration Works

### License limits respected

- The license server allows only a limited number of `ccmppower` tokens.
- Running with `--ntasks-per-node=4` stays within allowed limits.

### Correct license routing

- Uses POD licensing plus the required FlexNet server.

## How to Run

### Submit the job:
```bash
sbatch submit_starccm.sh
```

### Monitor:
```bash
squeue -u $USER
```

### Check output:
- `slurm-<jobid>.out`
- STAR-generated log files
- Updated `.sim` file (if saved by the macro)
